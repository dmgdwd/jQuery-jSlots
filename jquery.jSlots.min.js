/*
 * jQuery jSlots Plugin
 * http://matthewlein.com/jslot/
 * Copyright (c) 2011 Matthew Lein
 * Version: 1.0.2 (7/26/2012)
 * Dual licensed under the MIT and GPL licenses
 * Requires: jQuery v1.4.1 or later
 */
!function(s){s.jSlots=function(n,i){var e=this;e.$el=s(n),e.el=n,e.$el.data("jSlots",e),e.init=function(){e.options=s.extend({},s.jSlots.defaultOptions,i),e.setup(),e.bindEvents()},s.jSlots.defaultOptions={number:3,winnerNumber:0,spinner:"",spinEvent:"click",onStart:s.noop,onEnd:s.noop,onWin:s.noop,easing:"swing",time:7e3,loops:6,displayOrder:"DESC",winningNumArray:Array()},e.randomRange=function(n,i){return Math.floor(Math.random()*(1+i-n))+n},e.isSpinning=!1,e.spinSpeed=0,e.winCount=0,e.doneCount=0,e.$liHeight=0,e.$liWidth=0,e.walkIt=0,e.winners=[],e.allSlots=[],e.setup=function(){var n=e.$el,i=n.find("li").first();for(e.$liHeight=i.outerHeight(),e.$liWidth=i.outerWidth(),e.liCount=e.$el.children().length,e.listHeight=e.$liHeight*e.liCount,e.increment=e.options.time/e.options.loops/e.options.loops,e.displayOrder=Array(),_i=e.options.number+1;0<_i;_i--)e.displayOrder.push(_i);"ASC"==e.options.displayOrder&&e.displayOrder.reverse(),n.css("position","relative"),i.clone().appendTo(n),e.$wrapper=n.wrap('<div class="jSlots-wrapper text-center"></div><div class="clear-fix"></div>').parent(),e.$el.remove();for(var t=e.options.number-1;0<=t;t--)e.allSlots.push(new e.Slot)},e.bindEvents=function(){s(e.options.spinner).bind(e.options.spinEvent,function(n){e.isSpinning||e.playSlots()})},e.Slot=function(){this.spinSpeed=0,this.el=e.$el.clone().appendTo(e.$wrapper)[0],this.$el=s(this.el),this.loopCount=0,this.number=0},e.Slot.prototype={spinEm:function(){var n=this;n.$el.css("top",-e.listHeight).animate({top:"0px"},n.spinSpeed,"linear",function(){n.lowerSpeed()})},lowerSpeed:function(){this.spinSpeed+=e.increment,this.loopCount++,this.loopCount<e.options.loops?this.spinEm():this.finish()},finish:function(){var n=this;if(0<e.options.winningNumArray.length)var i=e.options.winningNumArray[e.walkIt];else i=e.randomRange(0,e.liCount);var t=-e.$liHeight*i,o=.5*this.spinSpeed*e.liCount/e.displayOrder[e.walkIt];n.$el.css("top",-e.listHeight).animate({top:t},o,e.options.easing,function(){e.checkWinner(i,n)}),s(window).resize(function(){e.viewportchange(i,n)}),e.walkIt+=1}},e.viewportchange=function(n,i){var t=i;e.$liHeight=s(".slot li").outerHeight(),finalPos=-(e.$liHeight*n-e.$liHeight),finalSpeed=.5*this.spinSpeed*e.liCount/n,t.$el.css("top",-e.listHeight).animate({top:finalPos},finalSpeed,e.options.easing,function(){})},e.checkWinner=function(n,i){if(e.doneCount++,i.number=n,(s.isArray(e.options.winnerNumber)&&-1<e.options.winnerNumber.indexOf(n)||n===e.options.winnerNumber)&&(e.winCount++,e.winners.push(i.$el)),e.doneCount===e.options.number){var t=[];s.each(e.allSlots,function(n,i){t[n]=i.number}),s.isFunction(e.options.onEnd)&&e.options.onEnd(t),e.winCount&&s.isFunction(e.options.onWin)&&e.options.onWin(e.winCount,e.winners,t),e.isSpinning=!1}},e.playSlots=function(){e.isSpinning=!0,e.winCount=0,e.doneCount=0,e.walkIt=0,e.winners=[],s.isFunction(e.options.onStart)&&e.options.onStart(),s.each(e.allSlots,function(n,i){this.spinSpeed=0,this.loopCount=0,this.spinEm()})},e.onWin=function(){s.isFunction(e.options.onWin)&&e.options.onWin()},e.init()},s.fn.jSlots=function(n){if(this.length)return this.each(function(){new s.jSlots(this,n)})}}(jQuery);
